// ============================================================
// EXCEL RIBBON - RÉPLICA PROFESIONAL DE MICROSOFT EXCEL
// ============================================================

import React, { useState, useRef, useEffect } from 'react';

// === CONFIGURACIÓN DE TABS ===
const RIBBON_TABS = [
  { id: 'home', label: 'Inicio' },
  { id: 'insert', label: 'Insertar' },
  { id: 'draw', label: 'Dibujar' },
  { id: 'pageLayout', label: 'Disposición de página' },
  { id: 'formulas', label: 'Fórmulas' },
  { id: 'data', label: 'Datos' },
  { id: 'review', label: 'Revisar' },
  { id: 'view', label: 'Vista' },
  { id: 'automate', label: 'Automatizar' }
];

// === ICONOS SVG ===
const Icons = {
  paste: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
      <rect x="8" y="2" width="8" height="4" rx="1" ry="1" />
    </svg>
  ),
  copy: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  ),
  cut: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <circle cx="6" cy="6" r="3" />
      <circle cx="6" cy="18" r="3" />
      <line x1="20" y1="4" x2="8.12" y2="15.88" />
      <line x1="14.47" y1="14.48" x2="20" y2="20" />
      <line x1="8.12" y1="8.12" x2="12" y2="12" />
    </svg>
  ),
  formatPainter: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <path d="M19 3H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z" />
      <path d="M12 11v8" />
      <path d="M8 21h8" />
    </svg>
  ),
  bold: (
    <svg viewBox="0 0 24 24" fill="currentColor">
      <path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6V4zm0 8h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6v-8z" />
    </svg>
  ),
  italic: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <line x1="19" y1="4" x2="10" y2="4" />
      <line x1="14" y1="20" x2="5" y2="20" />
      <line x1="15" y1="4" x2="9" y2="20" />
    </svg>
  ),
  underline: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <path d="M6 3v7a6 6 0 0 0 6 6 6 6 0 0 0 6-6V3" />
      <line x1="4" y1="21" x2="20" y2="21" />
    </svg>
  ),
  strikethrough: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <path d="M17.3 4.9c-1.2-.9-2.7-1.4-4.3-1.4-3.3 0-6 2.2-6 5s2.7 5 6 5" />
      <path d="M6.7 19.1c1.2.9 2.7 1.4 4.3 1.4 3.3 0 6-2.2 6-5" />
      <line x1="4" y1="12" x2="20" y2="12" />
    </svg>
  ),
  alignLeft: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <line x1="3" y1="6" x2="21" y2="6" />
      <line x1="3" y1="12" x2="15" y2="12" />
      <line x1="3" y1="18" x2="18" y2="18" />
    </svg>
  ),
  alignCenter: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <line x1="3" y1="6" x2="21" y2="6" />
      <line x1="6" y1="12" x2="18" y2="12" />
      <line x1="4" y1="18" x2="20" y2="18" />
    </svg>
  ),
  alignRight: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <line x1="3" y1="6" x2="21" y2="6" />
      <line x1="9" y1="12" x2="21" y2="12" />
      <line x1="6" y1="18" x2="21" y2="18" />
    </svg>
  ),
  alignJustify: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <line x1="3" y1="6" x2="21" y2="6" />
      <line x1="3" y1="12" x2="21" y2="12" />
      <line x1="3" y1="18" x2="21" y2="18" />
    </svg>
  ),
  merge: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <rect x="3" y="3" width="18" height="18" rx="2" />
      <line x1="12" y1="3" x2="12" y2="21" />
      <line x1="3" y1="12" x2="21" y2="12" />
    </svg>
  ),
  wrapText: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <line x1="3" y1="6" x2="21" y2="6" />
      <path d="M3 12h15a3 3 0 1 1 0 6h-4" />
      <polyline points="14 16 12 18 14 20" />
      <line x1="3" y1="18" x2="10" y2="18" />
    </svg>
  ),
  fontColor: (
    <svg viewBox="0 0 24 24">
      <path d="M11 4L6 20h2l1.5-4h5l1.5 4h2L13 4h-2zm.5 3.5L13.5 14h-3l2-6.5z" fill="currentColor"/>
      <rect x="3" y="20" width="18" height="3" fill="#ff0000"/>
    </svg>
  ),
  fillColor: (
    <svg viewBox="0 0 24 24">
      <path d="M19 11h-6V5h-2v6H5v2h6v6h2v-6h6z" fill="currentColor"/>
      <rect x="3" y="20" width="18" height="3" fill="#ffff00"/>
    </svg>
  ),
  borders: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <rect x="3" y="3" width="18" height="18" rx="1" />
    </svg>
  ),
  percent: (
    <svg viewBox="0 0 24 24" fill="currentColor">
      <text x="4" y="18" fontSize="16" fontWeight="bold">%</text>
    </svg>
  ),
  currency: (
    <svg viewBox="0 0 24 24" fill="currentColor">
      <text x="6" y="18" fontSize="16" fontWeight="bold">$</text>
    </svg>
  ),
  comma: (
    <svg viewBox="0 0 24 24" fill="currentColor">
      <text x="6" y="18" fontSize="14">,00</text>
    </svg>
  ),
  increaseDecimal: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <text x="2" y="16" fontSize="12" fill="currentColor">.0</text>
      <path d="M18 8l4 4-4 4" />
    </svg>
  ),
  decreaseDecimal: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <text x="6" y="16" fontSize="12" fill="currentColor">.0</text>
      <path d="M20 8l-4 4 4 4" />
    </svg>
  ),
  conditionalFormat: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <rect x="3" y="3" width="7" height="7" fill="#ef4444" />
      <rect x="14" y="3" width="7" height="7" fill="#f59e0b" />
      <rect x="3" y="14" width="7" height="7" fill="#10b981" />
      <rect x="14" y="14" width="7" height="7" fill="#3b82f6" />
    </svg>
  ),
  formatTable: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <rect x="3" y="3" width="18" height="18" rx="1" />
      <line x1="3" y1="9" x2="21" y2="9" />
      <line x1="9" y1="3" x2="9" y2="21" />
      <line x1="15" y1="3" x2="15" y2="21" />
      <line x1="3" y1="15" x2="21" y2="15" />
    </svg>
  ),
  cellStyles: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <rect x="3" y="3" width="18" height="18" rx="1" />
      <rect x="6" y="6" width="5" height="5" fill="#3b82f6" />
    </svg>
  ),
  insertRow: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <rect x="3" y="3" width="18" height="18" rx="1" />
      <line x1="3" y1="12" x2="21" y2="12" />
      <line x1="12" y1="8" x2="12" y2="16" />
    </svg>
  ),
  deleteRow: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <rect x="3" y="3" width="18" height="18" rx="1" />
      <line x1="8" y1="12" x2="16" y2="12" />
    </svg>
  ),
  format: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <rect x="3" y="3" width="18" height="18" rx="1" />
      <path d="M7 7h10M7 12h10M7 17h6" />
    </svg>
  ),
  sort: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <path d="M3 6h7M3 12h5M3 18h3" />
      <path d="M17 6v12M14 15l3 3 3-3" />
    </svg>
  ),
  filter: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3" />
    </svg>
  ),
  find: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <circle cx="11" cy="11" r="8" />
      <line x1="21" y1="21" x2="16.65" y2="16.65" />
    </svg>
  ),
  analyze: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <path d="M21 21H4.6c-.56 0-.84 0-1.05-.11a1 1 0 0 1-.44-.44C3 20.24 3 19.96 3 19.4V3" />
      <path d="m7 14 4-4 4 4 6-6" />
    </svg>
  ),
  comment: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
    </svg>
  ),
  share: (
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <circle cx="18" cy="5" r="3" />
      <circle cx="6" cy="12" r="3" />
      <circle cx="18" cy="19" r="3" />
      <line x1="8.59" y1="13.51" x2="15.42" y2="17.49" />
      <line x1="15.41" y1="6.51" x2="8.59" y2="10.49" />
    </svg>
  ),
  dropdown: (
    <svg viewBox="0 0 24 24" fill="currentColor" width="10" height="10">
      <path d="M7 10l5 5 5-5z" />
    </svg>
  )
};

// === COMPONENTE DROPDOWN ===
const Dropdown = ({ value, options, onChange, width = 120 }) => {
  const [isOpen, setIsOpen] = useState(false);
  const dropdownRef = useRef(null);

  useEffect(() => {
    const handleClickOutside = (e) => {
      if (dropdownRef.current && !dropdownRef.current.contains(e.target)) {
        setIsOpen(false);
      }
    };
    document.addEventListener('mousedown', handleClickOutside);
    return () => document.removeEventListener('mousedown', handleClickOutside);
  }, []);

  return (
    <div className="ribbon-dropdown" ref={dropdownRef} style={{ width }}>
      <button 
        className="dropdown-trigger"
        onClick={() => setIsOpen(!isOpen)}
      >
        <span className="dropdown-value">{value}</span>
        <span className="dropdown-arrow">{Icons.dropdown}</span>
      </button>
      {isOpen && (
        <div className="dropdown-menu">
          {options.map((option, idx) => (
            <button
              key={idx}
              className={`dropdown-option ${option === value ? 'selected' : ''}`}
              onClick={() => {
                onChange(option);
                setIsOpen(false);
              }}
            >
              {option}
            </button>
          ))}
        </div>
      )}
    </div>
  );
};

// === BOTÓN DEL RIBBON ===
const RibbonButton = ({ 
  icon, 
  label, 
  onClick, 
  size = 'small', 
  active = false, 
  disabled = false,
  hasDropdown = false,
  tooltip = ''
}) => {
  return (
    <button
      className={`ribbon-btn ribbon-btn-${size} ${active ? 'active' : ''}`}
      onClick={onClick}
      disabled={disabled}
      title={tooltip || label}
    >
      <span className="ribbon-btn-icon">{icon}</span>
      {size === 'large' && label && <span className="ribbon-btn-label">{label}</span>}
      {hasDropdown && <span className="ribbon-btn-dropdown">{Icons.dropdown}</span>}
    </button>
  );
};

// === BOTÓN CON SPLIT (BOTÓN + DROPDOWN) ===
const SplitButton = ({ icon, label, onClick, onDropdownClick, size = 'large' }) => {
  return (
    <div className={`ribbon-split-btn ribbon-btn-${size}`}>
      <button className="split-main" onClick={onClick} title={label}>
        <span className="ribbon-btn-icon">{icon}</span>
        {size === 'large' && <span className="ribbon-btn-label">{label}</span>}
      </button>
      <button className="split-dropdown" onClick={onDropdownClick}>
        {Icons.dropdown}
      </button>
    </div>
  );
};

// === GRUPO DEL RIBBON ===
const RibbonGroup = ({ title, children }) => {
  return (
    <div className="ribbon-group">
      <div className="ribbon-group-content">
        {children}
      </div>
      <div className="ribbon-group-title">{title}</div>
    </div>
  );
};

// === SEPARADOR VERTICAL ===
const RibbonSeparator = () => <div className="ribbon-separator" />;

// === CONTENIDO DEL TAB "INICIO" ===
const HomeTabContent = ({ 
  onAction, 
  currentFont, 
  currentSize, 
  currentFormat,
  cellFormat 
}) => {
  const fonts = [
    'Aptos Narrow', 'Arial', 'Calibri', 'Cambria', 'Consolas', 
    'Courier New', 'Georgia', 'Segoe UI', 'Tahoma', 'Times New Roman', 'Verdana'
  ];
  
  const sizes = ['8', '9', '10', '11', '12', '14', '16', '18', '20', '22', '24', '26', '28', '36', '48', '72'];
  
  const numberFormats = ['General', 'Número', 'Moneda', 'Contabilidad', 'Fecha corta', 'Fecha larga', 'Hora', 'Porcentaje', 'Fracción', 'Científica', 'Texto'];

  return (
    <div className="ribbon-tab-content">
      {/* Grupo: Portapapeles */}
      <RibbonGroup title="Portapapeles">
        <div className="ribbon-group-row">
          <SplitButton
            icon={Icons.paste}
            label="Pegar"
            size="large"
            onClick={() => onAction('paste')}
            onDropdownClick={() => onAction('pasteSpecial')}
          />
          <div className="ribbon-group-col">
            <RibbonButton
              icon={Icons.cut}
              label="Cortar"
              size="small"
              onClick={() => onAction('cut')}
              tooltip="Cortar (Ctrl+X)"
            />
            <RibbonButton
              icon={Icons.copy}
              label="Copiar"
              size="small"
              onClick={() => onAction('copy')}
              tooltip="Copiar (Ctrl+C)"
            />
            <RibbonButton
              icon={Icons.formatPainter}
              label="Copiar formato"
              size="small"
              onClick={() => onAction('formatPainter')}
              tooltip="Copiar formato"
            />
          </div>
        </div>
      </RibbonGroup>

      <RibbonSeparator />

      {/* Grupo: Fuente */}
      <RibbonGroup title="Fuente">
        <div className="ribbon-group-col">
          <div className="ribbon-row">
            <Dropdown
              value={currentFont}
              options={fonts}
              onChange={(font) => onAction('setFont', font)}
              width={140}
            />
            <Dropdown
              value={currentSize}
              options={sizes}
              onChange={(size) => onAction('setFontSize', size)}
              width={50}
            />
            <RibbonButton
              icon={<span style={{fontSize: '14px'}}>A↑</span>}
              size="small"
              onClick={() => onAction('increaseFontSize')}
              tooltip="Aumentar tamaño de fuente"
            />
            <RibbonButton
              icon={<span style={{fontSize: '14px'}}>A↓</span>}
              size="small"
              onClick={() => onAction('decreaseFontSize')}
              tooltip="Disminuir tamaño de fuente"
            />
          </div>
          <div className="ribbon-row">
            <RibbonButton
              icon={<strong>N</strong>}
              size="small"
              active={cellFormat?.bold}
              onClick={() => onAction('toggleBold')}
              tooltip="Negrita (Ctrl+B)"
            />
            <RibbonButton
              icon={<em>K</em>}
              size="small"
              active={cellFormat?.italic}
              onClick={() => onAction('toggleItalic')}
              tooltip="Cursiva (Ctrl+I)"
            />
            <RibbonButton
              icon={<u>S</u>}
              size="small"
              active={cellFormat?.underline}
              onClick={() => onAction('toggleUnderline')}
              tooltip="Subrayado (Ctrl+U)"
            />
            <RibbonSeparator />
            <RibbonButton
              icon={Icons.borders}
              size="small"
              hasDropdown
              onClick={() => onAction('borders')}
              tooltip="Bordes"
            />
            <RibbonButton
              icon={Icons.fillColor}
              size="small"
              hasDropdown
              onClick={() => onAction('fillColor')}
              tooltip="Color de relleno"
            />
            <RibbonButton
              icon={Icons.fontColor}
              size="small"
              hasDropdown
              onClick={() => onAction('fontColor')}
              tooltip="Color de fuente"
            />
          </div>
        </div>
      </RibbonGroup>

      <RibbonSeparator />

      {/* Grupo: Alineación */}
      <RibbonGroup title="Alineación">
        <div className="ribbon-group-col">
          <div className="ribbon-row">
            <RibbonButton
              icon={Icons.alignLeft}
              size="small"
              onClick={() => onAction('alignTop')}
              tooltip="Alinear arriba"
            />
            <RibbonButton
              icon={Icons.alignCenter}
              size="small"
              onClick={() => onAction('alignMiddle')}
              tooltip="Alinear centro vertical"
            />
            <RibbonButton
              icon={Icons.alignRight}
              size="small"
              onClick={() => onAction('alignBottom')}
              tooltip="Alinear abajo"
            />
            <RibbonSeparator />
            <RibbonButton
              icon={Icons.wrapText}
              size="small"
              hasDropdown
              onClick={() => onAction('wrapText')}
              tooltip="Ajustar texto"
            />
          </div>
          <div className="ribbon-row">
            <RibbonButton
              icon={Icons.alignLeft}
              size="small"
              active={cellFormat?.align === 'left'}
              onClick={() => onAction('alignLeft')}
              tooltip="Alinear izquierda"
            />
            <RibbonButton
              icon={Icons.alignCenter}
              size="small"
              active={cellFormat?.align === 'center'}
              onClick={() => onAction('alignCenter')}
              tooltip="Centrar"
            />
            <RibbonButton
              icon={Icons.alignRight}
              size="small"
              active={cellFormat?.align === 'right'}
              onClick={() => onAction('alignRight')}
              tooltip="Alinear derecha"
            />
            <RibbonSeparator />
            <RibbonButton
              icon={Icons.merge}
              size="small"
              hasDropdown
              onClick={() => onAction('merge')}
              tooltip="Combinar y centrar"
            />
          </div>
        </div>
      </RibbonGroup>

      <RibbonSeparator />

      {/* Grupo: Número */}
      <RibbonGroup title="Número">
        <div className="ribbon-group-col">
          <div className="ribbon-row">
            <Dropdown
              value={currentFormat}
              options={numberFormats}
              onChange={(format) => onAction('setNumberFormat', format)}
              width={110}
            />
          </div>
          <div className="ribbon-row">
            <RibbonButton
              icon={Icons.currency}
              size="small"
              hasDropdown
              onClick={() => onAction('formatCurrency')}
              tooltip="Formato de contabilidad"
            />
            <RibbonButton
              icon={Icons.percent}
              size="small"
              onClick={() => onAction('formatPercent')}
              tooltip="Formato de porcentaje"
            />
            <RibbonButton
              icon={Icons.comma}
              size="small"
              onClick={() => onAction('formatComma')}
              tooltip="Estilo millares"
            />
            <RibbonSeparator />
            <RibbonButton
              icon={<span style={{fontSize: '11px'}}>.0→</span>}
              size="small"
              onClick={() => onAction('increaseDecimal')}
              tooltip="Aumentar decimales"
            />
            <RibbonButton
              icon={<span style={{fontSize: '11px'}}>←.0</span>}
              size="small"
              onClick={() => onAction('decreaseDecimal')}
              tooltip="Disminuir decimales"
            />
          </div>
        </div>
      </RibbonGroup>

      <RibbonSeparator />

      {/* Grupo: Estilos */}
      <RibbonGroup title="Estilos">
        <div className="ribbon-group-row">
          <SplitButton
            icon={Icons.conditionalFormat}
            label="Formato condicional"
            size="large"
            onClick={() => onAction('conditionalFormat')}
            onDropdownClick={() => onAction('conditionalFormatMenu')}
          />
          <SplitButton
            icon={Icons.formatTable}
            label="Dar formato como tabla"
            size="large"
            onClick={() => onAction('formatAsTable')}
            onDropdownClick={() => onAction('formatAsTableMenu')}
          />
          <SplitButton
            icon={Icons.cellStyles}
            label="Estilos de celda"
            size="large"
            onClick={() => onAction('cellStyles')}
            onDropdownClick={() => onAction('cellStylesMenu')}
          />
        </div>
      </RibbonGroup>

      <RibbonSeparator />

      {/* Grupo: Celdas */}
      <RibbonGroup title="Celdas">
        <div className="ribbon-group-row">
          <SplitButton
            icon={Icons.insertRow}
            label="Insertar"
            size="large"
            onClick={() => onAction('insert')}
            onDropdownClick={() => onAction('insertMenu')}
          />
          <SplitButton
            icon={Icons.deleteRow}
            label="Eliminar"
            size="large"
            onClick={() => onAction('delete')}
            onDropdownClick={() => onAction('deleteMenu')}
          />
          <SplitButton
            icon={Icons.format}
            label="Formato"
            size="large"
            onClick={() => onAction('format')}
            onDropdownClick={() => onAction('formatMenu')}
          />
        </div>
      </RibbonGroup>

      <RibbonSeparator />

      {/* Grupo: Edición */}
      <RibbonGroup title="Edición">
        <div className="ribbon-group-row">
          <SplitButton
            icon={Icons.sort}
            label="Ordenar y filtrar"
            size="large"
            onClick={() => onAction('sort')}
            onDropdownClick={() => onAction('sortMenu')}
          />
          <SplitButton
            icon={Icons.find}
            label="Buscar y seleccionar"
            size="large"
            onClick={() => onAction('find')}
            onDropdownClick={() => onAction('findMenu')}
          />
        </div>
      </RibbonGroup>

      <RibbonSeparator />

      {/* Grupo: Analizar */}
      <RibbonGroup title="">
        <div className="ribbon-group-row">
          <SplitButton
            icon={Icons.analyze}
            label="Analizar datos"
            size="large"
            onClick={() => onAction('analyze')}
            onDropdownClick={() => onAction('analyzeMenu')}
          />
        </div>
      </RibbonGroup>
    </div>
  );
};

// === COMPONENTE PRINCIPAL DEL RIBBON ===
const ExcelRibbon = ({ onAction, cellFormat = {} }) => {
  const [activeTab, setActiveTab] = useState('home');
  const [currentFont, setCurrentFont] = useState('Aptos Narrow (Cue...');
  const [currentSize, setCurrentSize] = useState('12');
  const [currentFormat, setCurrentFormat] = useState('General');

  const handleAction = (action, value) => {
    console.log('Ribbon Action:', action, value);
    
    // Manejar acciones locales del ribbon
    switch(action) {
      case 'setFont':
        setCurrentFont(value);
        break;
      case 'setFontSize':
        setCurrentSize(value);
        break;
      case 'setNumberFormat':
        setCurrentFormat(value);
        break;
    }
    
    // Propagar al componente padre
    if (onAction) {
      onAction(action, value);
    }
  };

  const renderTabContent = () => {
    switch(activeTab) {
      case 'home':
        return (
          <HomeTabContent
            onAction={handleAction}
            currentFont={currentFont}
            currentSize={currentSize}
            currentFormat={currentFormat}
            cellFormat={cellFormat}
          />
        );
      case 'insert':
        return <div className="ribbon-tab-content"><p style={{padding: '20px', color: '#666'}}>Contenido de Insertar - Gráficos, Tablas, Imágenes...</p></div>;
      case 'formulas':
        return <div className="ribbon-tab-content"><p style={{padding: '20px', color: '#666'}}>Contenido de Fórmulas - SUM, AVERAGE, IF...</p></div>;
      case 'data':
        return <div className="ribbon-tab-content"><p style={{padding: '20px', color: '#666'}}>Contenido de Datos - Importar, Validación...</p></div>;
      default:
        return <div className="ribbon-tab-content"><p style={{padding: '20px', color: '#666'}}>Contenido de {activeTab}</p></div>;
    }
  };

  return (
    <div className="excel-ribbon">
      {/* Barra de tabs */}
      <div className="ribbon-tabs-bar">
        <div className="ribbon-tabs">
          {RIBBON_TABS.map(tab => (
            <button
              key={tab.id}
              className={`ribbon-tab ${activeTab === tab.id ? 'active' : ''}`}
              onClick={() => setActiveTab(tab.id)}
            >
              {tab.label}
            </button>
          ))}
        </div>
        <div className="ribbon-actions">
          <button className="ribbon-action-btn">
            {Icons.comment}
            <span>Comentarios</span>
          </button>
          <button className="ribbon-action-btn share">
            {Icons.share}
            <span>Compartir</span>
          </button>
        </div>
      </div>

      {/* Contenido del tab activo */}
      {renderTabContent()}
    </div>
  );
};

// === ESTILOS CSS ===
const ribbonStyles = `
/* === RIBBON CONTAINER === */
.excel-ribbon {
  background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
  border-bottom: 1px solid #d1d5db;
  font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 12px;
  user-select: none;
}

/* === BARRA DE TABS === */
.ribbon-tabs-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 8px;
  background: #fff;
  border-bottom: 1px solid #e5e7eb;
}

.ribbon-tabs {
  display: flex;
  gap: 0;
}

.ribbon-tab {
  padding: 8px 14px;
  border: none;
  background: transparent;
  color: #374151;
  font-size: 13px;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  transition: all 0.15s;
}

.ribbon-tab:hover {
  background: #f3f4f6;
}

.ribbon-tab.active {
  color: #16a34a;
  border-bottom-color: #16a34a;
  font-weight: 500;
}

/* === ACCIONES DERECHA === */
.ribbon-actions {
  display: flex;
  gap: 8px;
}

.ribbon-action-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  border: 1px solid #d1d5db;
  background: #fff;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
  color: #374151;
  transition: all 0.15s;
}

.ribbon-action-btn svg {
  width: 16px;
  height: 16px;
}

.ribbon-action-btn:hover {
  background: #f3f4f6;
}

.ribbon-action-btn.share {
  background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
  color: white;
  border-color: #15803d;
}

.ribbon-action-btn.share:hover {
  background: linear-gradient(135deg, #15803d 0%, #166534 100%);
}

/* === CONTENIDO DEL TAB === */
.ribbon-tab-content {
  display: flex;
  align-items: flex-start;
  padding: 4px 8px;
  gap: 2px;
  min-height: 80px;
  background: #f8f9fa;
}

/* === GRUPO DEL RIBBON === */
.ribbon-group {
  display: flex;
  flex-direction: column;
  padding: 4px 8px;
  position: relative;
}

.ribbon-group-content {
  display: flex;
  align-items: flex-start;
  gap: 4px;
  flex: 1;
}

.ribbon-group-title {
  font-size: 10px;
  color: #6b7280;
  text-align: center;
  padding-top: 4px;
  border-top: 1px solid #e5e7eb;
  margin-top: 4px;
}

.ribbon-group-row {
  display: flex;
  align-items: flex-start;
  gap: 2px;
}

.ribbon-group-col {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.ribbon-row {
  display: flex;
  align-items: center;
  gap: 1px;
}

/* === SEPARADOR === */
.ribbon-separator {
  width: 1px;
  height: 70px;
  background: #d1d5db;
  margin: 0 4px;
}

/* === BOTONES DEL RIBBON === */
.ribbon-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border: 1px solid transparent;
  background: transparent;
  border-radius: 3px;
  cursor: pointer;
  transition: all 0.1s;
  color: #374151;
}

.ribbon-btn:hover {
  background: #e5e7eb;
  border-color: #d1d5db;
}

.ribbon-btn.active {
  background: #dbeafe;
  border-color: #93c5fd;
}

.ribbon-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.ribbon-btn-small {
  width: 28px;
  height: 28px;
  padding: 4px;
}

.ribbon-btn-small .ribbon-btn-icon {
  width: 16px;
  height: 16px;
}

.ribbon-btn-small .ribbon-btn-icon svg {
  width: 16px;
  height: 16px;
}

.ribbon-btn-large {
  min-width: 50px;
  height: 66px;
  padding: 6px 8px;
  gap: 2px;
}

.ribbon-btn-large .ribbon-btn-icon {
  width: 28px;
  height: 28px;
}

.ribbon-btn-large .ribbon-btn-icon svg {
  width: 28px;
  height: 28px;
}

.ribbon-btn-label {
  font-size: 10px;
  text-align: center;
  line-height: 1.2;
  max-width: 70px;
  word-wrap: break-word;
}

.ribbon-btn-dropdown {
  margin-left: 2px;
}

.ribbon-btn-dropdown svg {
  width: 8px;
  height: 8px;
}

/* === SPLIT BUTTON === */
.ribbon-split-btn {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  border: 1px solid transparent;
  border-radius: 3px;
  overflow: hidden;
}

.ribbon-split-btn:hover {
  border-color: #d1d5db;
}

.ribbon-split-btn.ribbon-btn-large {
  min-width: 54px;
  height: 66px;
}

.split-main {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border: none;
  background: transparent;
  cursor: pointer;
  padding: 4px;
  gap: 2px;
}

.split-main:hover {
  background: #e5e7eb;
}

.split-main .ribbon-btn-icon {
  width: 24px;
  height: 24px;
}

.split-main .ribbon-btn-icon svg {
  width: 24px;
  height: 24px;
}

.split-main .ribbon-btn-label {
  font-size: 10px;
  color: #374151;
  line-height: 1.2;
}

.split-dropdown {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 16px;
  border: none;
  border-top: 1px solid #e5e7eb;
  background: transparent;
  cursor: pointer;
}

.split-dropdown:hover {
  background: #d1d5db;
}

.split-dropdown svg {
  width: 10px;
  height: 10px;
}

/* === DROPDOWN === */
.ribbon-dropdown {
  position: relative;
}

.dropdown-trigger {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  height: 24px;
  padding: 2px 6px;
  border: 1px solid #d1d5db;
  background: #fff;
  border-radius: 3px;
  cursor: pointer;
  font-size: 11px;
}

.dropdown-trigger:hover {
  border-color: #9ca3af;
}

.dropdown-value {
  flex: 1;
  text-align: left;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.dropdown-arrow svg {
  width: 10px;
  height: 10px;
}

.dropdown-menu {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  margin-top: 2px;
  background: #fff;
  border: 1px solid #d1d5db;
  border-radius: 4px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  max-height: 300px;
  overflow-y: auto;
  z-index: 1000;
}

.dropdown-option {
  display: block;
  width: 100%;
  padding: 6px 10px;
  border: none;
  background: transparent;
  text-align: left;
  font-size: 11px;
  cursor: pointer;
}

.dropdown-option:hover {
  background: #f3f4f6;
}

.dropdown-option.selected {
  background: #dbeafe;
  color: #1d4ed8;
}
`;

// Inyectar estilos
if (typeof document !== 'undefined') {
  const styleSheet = document.createElement('style');
  styleSheet.textContent = ribbonStyles;
  document.head.appendChild(styleSheet);
}

export default ExcelRibbon;