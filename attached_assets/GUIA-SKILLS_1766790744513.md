# ğŸ§© Sistema de Agent Skills - GuÃ­a de ImplementaciÃ³n

## DescripciÃ³n

Este sistema te permite crear una arquitectura modular de "Skills" en tu aplicaciÃ³n, similar a los Agent Skills de Anthropic. Cada Skill es un mÃ³dulo independiente que:

- Se registra con un nombre y descripciÃ³n
- Define "triggers" (palabras clave) que lo activan
- Ejecuta acciones especÃ­ficas
- Puede ser cargado/descargado dinÃ¡micamente

---

## ğŸš€ InstalaciÃ³n en Replit

### Paso 1: Instalar dependencias

```bash
npm install react react-dom
# Opcional para exportaciÃ³n Excel:
npm install xlsx
```

### Paso 2: Copiar el archivo

Copia `skill-system.jsx` a tu carpeta `src/`

### Paso 3: Usar en tu App

```jsx
// App.jsx
import SkillsDemo from './skill-system';

function App() {
  return <SkillsDemo />;
}

export default App;
```

---

## ğŸ“¦ Skills Incluidos

| Skill | DescripciÃ³n | Triggers |
|-------|-------------|----------|
| `background-processing` | Web Worker inmune a throttling | background, worker, procesar |
| `persistence` | IndexedDB para almacenamiento | guardar, persistir, storage |
| `formulas` | Motor de fÃ³rmulas estilo Excel | fÃ³rmula, calcular, sum |
| `charts` | GeneraciÃ³n de grÃ¡ficos | grÃ¡fico, chart, dashboard |
| `notifications` | Notificaciones del navegador | notificar, alerta |
| `tab-coordination` | SincronizaciÃ³n multi-tab | pestaÃ±as, sincronizar |
| `export` | Exportar a JSON/CSV/XLSX | exportar, descargar |

---

## ğŸ› ï¸ CÃ³mo Crear un Skill Personalizado

### Estructura BÃ¡sica

```jsx
import { BaseSkill } from './skill-system';

class MiSkillPersonalizado extends BaseSkill {
  constructor() {
    super();
    
    // Metadatos del Skill
    this.metadata = {
      name: 'mi-skill',
      version: '1.0.0',
      description: 'DescripciÃ³n de lo que hace mi skill',
      triggers: ['palabra1', 'palabra2', 'acciÃ³n'],
      priority: 5  // Mayor nÃºmero = mayor prioridad
    };
    
    // Estado interno
    this.miEstado = {};
  }

  // InicializaciÃ³n (se llama al cargar el skill)
  async initialize(context) {
    await super.initialize(context);
    // Tu cÃ³digo de inicializaciÃ³n
    console.log('Mi skill inicializado');
  }

  // Verificar si puede manejar una solicitud (opcional)
  canHandle(request) {
    // LÃ³gica personalizada o usar la default
    return super.canHandle(request);
  }

  // Ejecutar el skill
  async execute(params) {
    const { request, ...otrosParams } = params;
    
    // Tu lÃ³gica aquÃ­
    const resultado = await this.hacerAlgo(otrosParams);
    
    return resultado;
  }

  // MÃ©todo personalizado
  async hacerAlgo(params) {
    return { success: true, data: params };
  }

  // Instrucciones del skill (documentaciÃ³n)
  getInstructions() {
    return `
# Mi Skill Personalizado

## DescripciÃ³n
ExplicaciÃ³n de lo que hace este skill.

## Uso
\`\`\`javascript
await skillManager.execute('palabra1', { param: 'valor' });
\`\`\`

## ParÃ¡metros
- \`param\`: DescripciÃ³n del parÃ¡metro
    `;
  }

  // Limpieza (se llama al descargar)
  async cleanup() {
    // Limpiar recursos
    await super.cleanup();
  }
}

export default MiSkillPersonalizado;
```

### Registrar el Skill

```jsx
import { createSkillManager } from './skill-system';
import MiSkillPersonalizado from './MiSkillPersonalizado';

// Crear manager con skills por defecto
const manager = createSkillManager();

// Agregar tu skill personalizado
manager.register(new MiSkillPersonalizado());

// Inicializar todos
await manager.loadAll();

// Usar
const result = await manager.execute('palabra1', { param: 'valor' });
```

---

## ğŸ“ Ejemplos de Skills Personalizados

### Skill de ValidaciÃ³n

```jsx
class ValidationSkill extends BaseSkill {
  constructor() {
    super();
    this.metadata = {
      name: 'validation',
      version: '1.0.0',
      description: 'ValidaciÃ³n de datos con esquemas',
      triggers: ['validar', 'validate', 'verificar', 'schema'],
      priority: 6
    };
    
    this.schemas = new Map();
  }

  async execute({ schema, data, schemaName }) {
    // Si se proporciona un nombre de schema, guardarlo
    if (schemaName && schema) {
      this.schemas.set(schemaName, schema);
      return { success: true, action: 'schema_saved' };
    }
    
    // Obtener schema por nombre o usar el proporcionado
    const schemaToUse = schemaName 
      ? this.schemas.get(schemaName) 
      : schema;
    
    if (!schemaToUse) {
      throw new Error('Schema no encontrado');
    }
    
    // Validar
    const errors = this.validate(data, schemaToUse);
    
    return {
      valid: errors.length === 0,
      errors
    };
  }

  validate(data, schema) {
    const errors = [];
    
    for (const [field, rules] of Object.entries(schema)) {
      const value = data[field];
      
      // Required
      if (rules.required && (value === undefined || value === null || value === '')) {
        errors.push({ field, error: 'Campo requerido' });
        continue;
      }
      
      // Type
      if (rules.type && value !== undefined) {
        if (rules.type === 'email' && !this.isValidEmail(value)) {
          errors.push({ field, error: 'Email invÃ¡lido' });
        }
        if (rules.type === 'number' && typeof value !== 'number') {
          errors.push({ field, error: 'Debe ser nÃºmero' });
        }
      }
      
      // Min length
      if (rules.minLength && typeof value === 'string' && value.length < rules.minLength) {
        errors.push({ field, error: `MÃ­nimo ${rules.minLength} caracteres` });
      }
      
      // Max length
      if (rules.maxLength && typeof value === 'string' && value.length > rules.maxLength) {
        errors.push({ field, error: `MÃ¡ximo ${rules.maxLength} caracteres` });
      }
      
      // Min value
      if (rules.min !== undefined && typeof value === 'number' && value < rules.min) {
        errors.push({ field, error: `MÃ­nimo ${rules.min}` });
      }
      
      // Custom validation
      if (rules.custom && !rules.custom(value)) {
        errors.push({ field, error: rules.customMessage || 'ValidaciÃ³n personalizada fallÃ³' });
      }
    }
    
    return errors;
  }

  isValidEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  }

  getInstructions() {
    return `
# Validation Skill

## Uso
\`\`\`javascript
// Definir schema
const schema = {
  email: { required: true, type: 'email' },
  age: { required: true, type: 'number', min: 18 },
  name: { required: true, minLength: 2, maxLength: 50 }
};

// Validar
const result = await skillManager.execute('validar datos', {
  schema,
  data: { email: 'test@example.com', age: 25, name: 'Juan' }
});

// result: { valid: true, errors: [] }
\`\`\`
    `;
  }
}
```

### Skill de API Fetch

```jsx
class ApiFetchSkill extends BaseSkill {
  constructor() {
    super();
    this.metadata = {
      name: 'api-fetch',
      version: '1.0.0',
      description: 'Realizar peticiones HTTP a APIs',
      triggers: ['fetch', 'api', 'http', 'get', 'post', 'request'],
      priority: 7
    };
    
    this.baseUrl = '';
    this.defaultHeaders = {};
  }

  async initialize(context) {
    await super.initialize(context);
    
    if (context.apiBaseUrl) {
      this.baseUrl = context.apiBaseUrl;
    }
    if (context.apiHeaders) {
      this.defaultHeaders = context.apiHeaders;
    }
  }

  async execute({ method = 'GET', url, data, headers = {} }) {
    const fullUrl = url.startsWith('http') ? url : `${this.baseUrl}${url}`;
    
    const options = {
      method: method.toUpperCase(),
      headers: {
        'Content-Type': 'application/json',
        ...this.defaultHeaders,
        ...headers
      }
    };
    
    if (data && method !== 'GET') {
      options.body = JSON.stringify(data);
    }
    
    try {
      const response = await fetch(fullUrl, options);
      const responseData = await response.json();
      
      return {
        success: response.ok,
        status: response.status,
        data: responseData
      };
    } catch (error) {
      return {
        success: false,
        error: error.message
      };
    }
  }

  // MÃ©todos de conveniencia
  async get(url, headers) {
    return this.execute({ method: 'GET', url, headers });
  }

  async post(url, data, headers) {
    return this.execute({ method: 'POST', url, data, headers });
  }

  async put(url, data, headers) {
    return this.execute({ method: 'PUT', url, data, headers });
  }

  async delete(url, headers) {
    return this.execute({ method: 'DELETE', url, headers });
  }

  getInstructions() {
    return `
# API Fetch Skill

## Uso
\`\`\`javascript
// GET
const users = await skillManager.execute('fetch api', {
  method: 'GET',
  url: 'https://api.example.com/users'
});

// POST
const newUser = await skillManager.execute('post api', {
  method: 'POST',
  url: 'https://api.example.com/users',
  data: { name: 'Juan', email: 'juan@example.com' }
});
\`\`\`
    `;
  }
}
```

### Skill de Estado Global

```jsx
class StateSkill extends BaseSkill {
  constructor() {
    super();
    this.metadata = {
      name: 'state',
      version: '1.0.0',
      description: 'GestiÃ³n de estado global de la aplicaciÃ³n',
      triggers: ['estado', 'state', 'store', 'global'],
      priority: 8
    };
    
    this.state = {};
    this.listeners = new Map();
  }

  async execute({ action, key, value, listener }) {
    switch (action) {
      case 'get':
        return key ? this.state[key] : { ...this.state };
      
      case 'set':
        return this.setState(key, value);
      
      case 'update':
        return this.updateState(key, value);
      
      case 'delete':
        return this.deleteState(key);
      
      case 'subscribe':
        return this.subscribe(key, listener);
      
      case 'reset':
        return this.reset();
      
      default:
        throw new Error(`AcciÃ³n desconocida: ${action}`);
    }
  }

  setState(key, value) {
    const oldValue = this.state[key];
    this.state[key] = value;
    
    this._notify(key, value, oldValue);
    
    return { success: true, key, value };
  }

  updateState(key, updater) {
    const oldValue = this.state[key];
    const newValue = typeof updater === 'function' 
      ? updater(oldValue) 
      : { ...oldValue, ...updater };
    
    return this.setState(key, newValue);
  }

  deleteState(key) {
    const value = this.state[key];
    delete this.state[key];
    
    this._notify(key, undefined, value);
    
    return { success: true, key };
  }

  subscribe(key, listener) {
    if (!this.listeners.has(key)) {
      this.listeners.set(key, []);
    }
    this.listeners.get(key).push(listener);
    
    // Retornar funciÃ³n para desuscribirse
    return {
      unsubscribe: () => {
        const listeners = this.listeners.get(key) || [];
        const index = listeners.indexOf(listener);
        if (index > -1) listeners.splice(index, 1);
      }
    };
  }

  _notify(key, newValue, oldValue) {
    const listeners = this.listeners.get(key) || [];
    listeners.forEach(listener => {
      try {
        listener(newValue, oldValue);
      } catch (error) {
        console.error('Error en listener:', error);
      }
    });
  }

  reset() {
    const keys = Object.keys(this.state);
    this.state = {};
    
    keys.forEach(key => this._notify(key, undefined));
    
    return { success: true };
  }

  getInstructions() {
    return `
# State Skill

## Uso
\`\`\`javascript
// Set
await skillManager.execute('set estado', {
  action: 'set',
  key: 'user',
  value: { name: 'Juan', logged: true }
});

// Get
const user = await skillManager.execute('get estado', {
  action: 'get',
  key: 'user'
});

// Update
await skillManager.execute('update estado', {
  action: 'update',
  key: 'user',
  value: { logged: false }
});

// Subscribe
const skill = skillManager.get('state');
skill.subscribe('user', (newValue, oldValue) => {
  console.log('User cambiÃ³:', newValue);
});
\`\`\`
    `;
  }
}
```

---

## ğŸ›ï¸ API del SkillManager

### MÃ©todos Principales

```javascript
// Crear manager
const manager = new SkillManager();

// Registrar skill
manager.register(new MiSkill());

// Registrar mÃºltiples
manager.registerAll([new Skill1(), new Skill2()]);

// Obtener skill
const skill = manager.get('nombre-skill');

// Listar todos
const lista = manager.list();

// Cargar skill especÃ­fico
await manager.load('nombre-skill');

// Cargar todos
await manager.loadAll();

// Ejecutar skill (encuentra el apropiado automÃ¡ticamente)
const result = await manager.execute('mi solicitud', { params });

// Ejecutar secuencia
const results = await manager.executeSequence([
  { request: 'acciÃ³n 1', params: {} },
  { request: 'acciÃ³n 2', params: {}, stopOnError: true }
]);

// Obtener instrucciones
const instrucciones = manager.getInstructions('nombre-skill');

// Eventos
manager.on('skillRegistered', ({ name, skill }) => {});
manager.on('skillLoaded', ({ name, skill }) => {});
manager.on('beforeExecute', ({ skill, request, params }) => {});
manager.on('afterExecute', ({ skill, request, params, result }) => {});
manager.on('executeError', ({ skill, request, params, error }) => {});

// Descargar
await manager.unload('nombre-skill');
await manager.unloadAll();
```

---

## ğŸ”Œ IntegraciÃ³n con React

### Hook useSkills

```jsx
import { useSkills } from './skill-system';

function MyComponent() {
  const { 
    isReady,      // boolean - Skills cargados
    skills,       // Lista de skills
    execute,      // FunciÃ³n para ejecutar
    getSkill,     // Obtener skill por nombre
    manager       // Instancia del manager
  } = useSkills();

  if (!isReady) return <div>Cargando...</div>;

  const handleClick = async () => {
    const result = await execute('mi acciÃ³n', { param: 'valor' });
    console.log(result);
  };

  return (
    <div>
      <p>Skills disponibles: {skills.length}</p>
      <button onClick={handleClick}>Ejecutar</button>
    </div>
  );
}
```

---

## ğŸ“ Estructura de Archivos Recomendada

```
src/
â”œâ”€â”€ skills/
â”‚   â”œâ”€â”€ index.js           # Exporta todos los skills
â”‚   â”œâ”€â”€ BaseSkill.js       # Clase base
â”‚   â”œâ”€â”€ SkillManager.js    # Manager
â”‚   â”œâ”€â”€ BackgroundSkill.js
â”‚   â”œâ”€â”€ PersistenceSkill.js
â”‚   â”œâ”€â”€ FormulaSkill.js
â”‚   â”œâ”€â”€ ChartSkill.js
â”‚   â””â”€â”€ custom/
â”‚       â”œâ”€â”€ ValidationSkill.js
â”‚       â””â”€â”€ ApiSkill.js
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useSkills.js
â”œâ”€â”€ components/
â”‚   â””â”€â”€ SkillsPanel.jsx
â””â”€â”€ App.jsx
```

---

## âœ… Checklist de ImplementaciÃ³n

- [ ] Copiar `skill-system.jsx` a tu proyecto
- [ ] Instalar dependencias (react)
- [ ] Crear tus Skills personalizados extendiendo `BaseSkill`
- [ ] Registrar tus Skills con `manager.register()`
- [ ] Usar `useSkills()` hook en tus componentes
- [ ] Documentar tus Skills con `getInstructions()`
- [ ] Agregar manejo de errores en `execute()`
- [ ] Implementar `cleanup()` para liberar recursos

---

## ğŸ‰ Â¡Listo!

Ahora tienes un sistema de Agent Skills completamente funcional en tu aplicaciÃ³n. Puedes:

1. **Usar los Skills predefinidos** para tareas comunes
2. **Crear Skills personalizados** para tu lÃ³gica de negocio
3. **Combinar Skills** para flujos complejos
4. **Extender el sistema** agregando nuevas capacidades

Â¿Preguntas? Revisa los ejemplos en el cÃ³digo fuente.
