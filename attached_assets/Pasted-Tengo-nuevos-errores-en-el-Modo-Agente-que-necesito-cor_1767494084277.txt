Tengo nuevos errores en el Modo Agente que necesito corregir:
1) Botón de detener/cancelar no se activa durante la ejecución: Cuando el agente está en estado "Iniciando..." o "Procesando tu solicitud...", el botón de cancelar/detener debería estar habilitado pero no lo está. En el componente del chat, verifica que el estado isLoading o isAgentRunning se esté pasando correctamente al botón de stop. Implementa: <button disabled={!isAgentRunning} onClick={handleCancel}>Detener</button>. Asegúrate de que setIsAgentRunning(true) se ejecute ANTES de iniciar la llamada a la API y que el handler handleCancel llame a abortController.abort() para cancelar el fetch y también emita un evento al backend para detener la ejecución del agente.
2) El input no se limpia al enviar el mensaje: El mensaje del usuario aparece en el chat pero también permanece en el campo de texto. En el handler onSubmit o handleSendMessage, asegúrate de ejecutar setInputValue('') o inputRef.current.value = '' inmediatamente después de capturar el valor y ANTES de agregarlo al array de mensajes. El orden correcto es: const message = inputValue; setInputValue(''); setMessages(prev => [...prev, { role: 'user', content: message }]); startAgentExecution(message);
3) Latencia excesiva / posible problema de conexión con API: El agente tarda demasiado en "Iniciando..." lo cual indica un problema de conexión con la API de Gemini. Verifica: a) Que la API key esté correctamente configurada en las variables de entorno y se esté pasando en el header Authorization: Bearer ${API_KEY} o x-goog-api-key: ${API_KEY}. b) Que el endpoint sea correcto: https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent. c) Agrega timeout a la llamada fetch: const controller = new AbortController(); const timeout = setTimeout(() => controller.abort(), 30000); fetch(url, { signal: controller.signal, ... }). d) Implementa logging para ver en consola cuánto tarda cada etapa: console.time('api-call'); await fetch(...); console.timeEnd('api-call');. e) Verifica que no haya múltiples llamadas simultáneas - usa una flag if (isProcessing) return; al inicio del handler.
4) Feedback visual durante la espera: Los skeleton loaders (las barras morada y azul) están bien, pero agrega un indicador de progreso más claro. Implementa estados específicos: 'idle' | 'connecting' | 'planning' | 'executing' | 'completed' | 'error' y muestra mensajes correspondientes como "Conectando con IA...", "Planificando pasos...", "Ejecutando paso 1 de N...". Si pasan más de 10 segundos sin respuesta, muestra un mensaje de advertencia: "La conexión está tardando más de lo esperado...".