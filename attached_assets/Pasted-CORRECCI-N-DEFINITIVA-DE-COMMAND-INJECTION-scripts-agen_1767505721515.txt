CORRECCI√ìN DEFINITIVA DE COMMAND INJECTION - scripts/agent-certify.cjs

El esc√°ner de seguridad detecta que `commandKey` (par√°metro de funci√≥n) fluye hacia `spawnSync`. 
La √öNICA forma de resolver esto es eliminar el par√°metro y hardcodear los comandos directamente.

REEMPLAZA TODO el contenido de scripts/agent-certify.cjs con este c√≥digo:
```javascript
/**
 * Agent Certify Script - Versi√≥n Segura
 * 
 * NOTA DE SEGURIDAD: Este archivo NO acepta comandos como par√°metros.
 * Todos los comandos est√°n hardcodeados para prevenir command injection.
 */

const { spawnSync } = require('child_process');
const path = require('path');
const fs = require('fs');

// ============================================================================
// CONFIGURACI√ìN DE SEGURIDAD
// ============================================================================

const MAX_BUFFER = 10 * 1024 * 1024; // 10MB
const TIMEOUT = 300000; // 5 minutos

const SAFE_ENV = {
  ...process.env,
  LD_PRELOAD: undefined,
  LD_LIBRARY_PATH: undefined,
  NODE_OPTIONS: undefined
};

const SPAWN_OPTIONS = {
  encoding: 'utf8',
  timeout: TIMEOUT,
  maxBuffer: MAX_BUFFER,
  shell: false,
  env: SAFE_ENV
};

// ============================================================================
// FUNCIONES DE COMANDOS HARDCODEADOS
// Cada funci√≥n ejecuta UN comando espec√≠fico - sin par√°metros de comando
// ============================================================================

/**
 * Ejecuta npm audit
 * @param {string} cwd - Directorio de trabajo (validado)
 * @returns {object} Resultado de la ejecuci√≥n
 */
function runNpmAudit(cwd) {
  console.log('[CERTIFY] Ejecutando: npm audit');
  
  const result = spawnSync('npm', ['audit', '--audit-level=high'], {
    ...SPAWN_OPTIONS,
    cwd,
    stdio: ['pipe', 'pipe', 'pipe']
  });
  
  return {
    success: result.status === 0,
    stdout: result.stdout || '',
    stderr: result.stderr || '',
    code: result.status
  };
}

/**
 * Ejecuta npm install
 * @param {string} cwd - Directorio de trabajo (validado)
 * @returns {object} Resultado de la ejecuci√≥n
 */
function runNpmInstall(cwd) {
  console.log('[CERTIFY] Ejecutando: npm install');
  
  const result = spawnSync('npm', ['install'], {
    ...SPAWN_OPTIONS,
    cwd,
    stdio: ['pipe', 'pipe', 'pipe']
  });
  
  return {
    success: result.status === 0,
    stdout: result.stdout || '',
    stderr: result.stderr || '',
    code: result.status
  };
}

/**
 * Ejecuta npm run lint
 * @param {string} cwd - Directorio de trabajo (validado)
 * @returns {object} Resultado de la ejecuci√≥n
 */
function runNpmLint(cwd) {
  console.log('[CERTIFY] Ejecutando: npm run lint');
  
  const result = spawnSync('npm', ['run', 'lint'], {
    ...SPAWN_OPTIONS,
    cwd,
    stdio: ['pipe', 'pipe', 'pipe']
  });
  
  return {
    success: result.status === 0,
    stdout: result.stdout || '',
    stderr: result.stderr || '',
    code: result.status
  };
}

/**
 * Ejecuta npm run build
 * @param {string} cwd - Directorio de trabajo (validado)
 * @returns {object} Resultado de la ejecuci√≥n
 */
function runNpmBuild(cwd) {
  console.log('[CERTIFY] Ejecutando: npm run build');
  
  const result = spawnSync('npm', ['run', 'build'], {
    ...SPAWN_OPTIONS,
    cwd,
    stdio: ['pipe', 'pipe', 'pipe']
  });
  
  return {
    success: result.status === 0,
    stdout: result.stdout || '',
    stderr: result.stderr || '',
    code: result.status
  };
}

/**
 * Ejecuta npm test
 * @param {string} cwd - Directorio de trabajo (validado)
 * @returns {object} Resultado de la ejecuci√≥n
 */
function runNpmTest(cwd) {
  console.log('[CERTIFY] Ejecutando: npm test');
  
  const result = spawnSync('npm', ['test', '--', '--passWithNoTests'], {
    ...SPAWN_OPTIONS,
    cwd,
    stdio: ['pipe', 'pipe', 'pipe']
  });
  
  return {
    success: result.status === 0,
    stdout: result.stdout || '',
    stderr: result.stderr || '',
    code: result.status
  };
}

/**
 * Ejecuta npx tsc --noEmit (type check)
 * @param {string} cwd - Directorio de trabajo (validado)
 * @returns {object} Resultado de la ejecuci√≥n
 */
function runTypeCheck(cwd) {
  console.log('[CERTIFY] Ejecutando: npx tsc --noEmit');
  
  const result = spawnSync('npx', ['tsc', '--noEmit'], {
    ...SPAWN_OPTIONS,
    cwd,
    stdio: ['pipe', 'pipe', 'pipe']
  });
  
  return {
    success: result.status === 0,
    stdout: result.stdout || '',
    stderr: result.stderr || '',
    code: result.status
  };
}

/**
 * Ejecuta npx prisma generate
 * @param {string} cwd - Directorio de trabajo (validado)
 * @returns {object} Resultado de la ejecuci√≥n
 */
function runPrismaGenerate(cwd) {
  console.log('[CERTIFY] Ejecutando: npx prisma generate');
  
  const result = spawnSync('npx', ['prisma', 'generate'], {
    ...SPAWN_OPTIONS,
    cwd,
    stdio: ['pipe', 'pipe', 'pipe']
  });
  
  return {
    success: result.status === 0,
    stdout: result.stdout || '',
    stderr: result.stderr || '',
    code: result.status
  };
}

/**
 * Ejecuta npx drizzle-kit generate
 * @param {string} cwd - Directorio de trabajo (validado)
 * @returns {object} Resultado de la ejecuci√≥n
 */
function runDrizzleGenerate(cwd) {
  console.log('[CERTIFY] Ejecutando: npx drizzle-kit generate');
  
  const result = spawnSync('npx', ['drizzle-kit', 'generate'], {
    ...SPAWN_OPTIONS,
    cwd,
    stdio: ['pipe', 'pipe', 'pipe']
  });
  
  return {
    success: result.status === 0,
    stdout: result.stdout || '',
    stderr: result.stderr || '',
    code: result.status
  };
}

// ============================================================================
// VALIDACI√ìN DE PATH
// ============================================================================

/**
 * Valida que el path sea seguro (dentro del directorio actual)
 * @param {string} inputPath - Path a validar
 * @returns {string} Path absoluto validado
 * @throws {Error} Si el path es inv√°lido
 */
function validatePath(inputPath) {
  if (!inputPath || typeof inputPath !== 'string') {
    throw new Error('Path inv√°lido: debe ser un string no vac√≠o');
  }
  
  // Resolver path absoluto
  const resolvedPath = path.resolve(inputPath);
  const currentDir = process.cwd();
  
  // Verificar que est√© dentro del directorio actual
  if (!resolvedPath.startsWith(currentDir)) {
    throw new Error(`Path fuera del directorio permitido: ${inputPath}`);
  }
  
  // Verificar que exista
  if (!fs.existsSync(resolvedPath)) {
    throw new Error(`Path no existe: ${resolvedPath}`);
  }
  
  // Verificar que sea directorio
  if (!fs.statSync(resolvedPath).isDirectory()) {
    throw new Error(`Path no es un directorio: ${resolvedPath}`);
  }
  
  return resolvedPath;
}

// ============================================================================
// FUNCI√ìN PRINCIPAL DE CERTIFICACI√ìN
// ============================================================================

/**
 * Ejecuta la certificaci√≥n completa del agente
 * @param {string} projectPath - Ruta del proyecto (opcional, default '.')
 * @returns {boolean} true si todas las pruebas pasan
 */
function certifyAgent(projectPath = '.') {
  console.log('');
  console.log('‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó');
  console.log('‚ïë           AGENT CERTIFY - CERTIFICACI√ìN DE SEGURIDAD         ‚ïë');
  console.log('‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù');
  console.log('');
  
  // Validar path
  let safePath;
  try {
    safePath = validatePath(projectPath);
    console.log(`[CERTIFY] Directorio: ${safePath}`);
  } catch (error) {
    console.error(`[CERTIFY] ‚ùå Error de path: ${error.message}`);
    return false;
  }
  
  // Definir checks a ejecutar (usando funciones hardcodeadas)
  const checks = [
    { name: 'Auditor√≠a de Seguridad', fn: runNpmAudit },
    { name: 'Type Check (TypeScript)', fn: runTypeCheck },
    { name: 'Linting', fn: runNpmLint },
    { name: 'Tests', fn: runNpmTest }
  ];
  
  const results = [];
  
  console.log('');
  console.log('[CERTIFY] Iniciando verificaciones...');
  console.log('‚îÄ'.repeat(60));
  
  // Ejecutar cada check
  for (const check of checks) {
    console.log('');
    console.log(`[CERTIFY] üîç ${check.name}...`);
    
    try {
      // Llamar la funci√≥n hardcodeada - NO hay par√°metro de comando
      const result = check.fn(safePath);
      
      if (result.success) {
        console.log(`[CERTIFY] ‚úÖ ${check.name}: PAS√ì`);
      } else {
        console.log(`[CERTIFY] ‚ö†Ô∏è  ${check.name}: FALL√ì (c√≥digo ${result.code})`);
        if (result.stderr) {
          console.log(`[CERTIFY]    Error: ${result.stderr.slice(0, 200)}`);
        }
      }
      
      results.push({
        name: check.name,
        success: result.success,
        code: result.code,
        output: result.stdout,
        error: result.stderr
      });
      
    } catch (error) {
      console.log(`[CERTIFY] ‚ùå ${check.name}: ERROR - ${error.message}`);
      results.push({
        name: check.name,
        success: false,
        code: -1,
        error: error.message
      });
    }
  }
  
  // Resumen final
  console.log('');
  console.log('‚ïê'.repeat(60));
  console.log('[CERTIFY] RESUMEN DE CERTIFICACI√ìN');
  console.log('‚ïê'.repeat(60));
  
  const passed = results.filter(r => r.success).length;
  const total = results.length;
  
  results.forEach(r => {
    const icon = r.success ? '‚úÖ' : '‚ùå';
    const status = r.success ? 'PAS√ì' : 'FALL√ì';
    console.log(`  ${icon} ${r.name}: ${status}`);
  });
  
  console.log('‚îÄ'.repeat(60));
  console.log(`  Total: ${passed}/${total} verificaciones pasadas`);
  console.log('‚ïê'.repeat(60));
  
  const allPassed = passed === total;
  
  if (allPassed) {
    console.log('');
    console.log('  üéâ CERTIFICACI√ìN EXITOSA');
    console.log('');
  } else {
    console.log('');
    console.log('  ‚õî CERTIFICACI√ìN FALLIDA');
    console.log('  Revisa los errores arriba antes de continuar.');
    console.log('');
  }
  
  return allPassed;
}

// ============================================================================
// EXPORTACIONES
// ============================================================================

module.exports = {
  certifyAgent,
  // Exportar funciones individuales para uso espec√≠fico
  runNpmAudit,
  runNpmInstall,
  runNpmLint,
  runNpmBuild,
  runNpmTest,
  runTypeCheck,
  runPrismaGenerate,
  runDrizzleGenerate,
  validatePath
};

// ============================================================================
// EJECUCI√ìN DIRECTA
// ============================================================================

if (require.main === module) {
  const projectPath = process.argv[2] || '.';
  
  try {
    const success = certifyAgent(projectPath);
    process.exit(success ? 0 : 1);
  } catch (error) {
    console.error('[CERTIFY] Error fatal:', error.message);
    process.exit(1);
  }
}
```

================================================================================
¬øPOR QU√â ESTO RESUELVE EL PROBLEMA?
================================================================================

El esc√°ner detectaba:
function runCommand(commandKey, ...) {  // ‚Üê commandKey es par√°metro
const cmd = WHITELIST[commandKey];    // ‚Üê fluye hacia variable
spawnSync(cmd, ...);                  // ‚Üê variable va a child_process
}

Ahora NO hay flujo de datos desde par√°metros hacia child_process:
function runNpmAudit(cwd) {             // ‚Üê NO hay par√°metro de comando
spawnSync('npm', ['audit', ...]);     // ‚Üê comando HARDCODEADO
}

CAMBIOS CLAVE:
1. ‚ùå ELIMINADO: Funci√≥n gen√©rica `runSecureCommand(commandKey, args)`
2. ‚úÖ NUEVO: Funciones espec√≠ficas `runNpmAudit()`, `runNpmTest()`, etc.
3. ‚úÖ Comandos hardcodeados como strings literales
4. ‚úÖ NO hay par√°metro que fluya hacia `spawnSync`
5. ‚úÖ El √∫nico par√°metro (`cwd`) es el directorio de trabajo, no el comando

================================================================================
INSTRUCCI√ìN FINAL
================================================================================

1. Borra TODO el contenido de scripts/agent-certify.cjs
2. Pega el c√≥digo de arriba
3. El error de seguridad desaparecer√° porque ya no hay flujo de datos
   desde par√°metros de funci√≥n hacia child_process