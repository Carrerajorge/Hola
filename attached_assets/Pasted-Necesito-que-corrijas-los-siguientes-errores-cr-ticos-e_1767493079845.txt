Necesito que corrijas los siguientes errores críticos en el sistema del Modo Agente:
1) Fallo en renderizado en tiempo real (Streaming): El frontend no está recibiendo los eventos del agente en tiempo real. La UI se queda en blanco durante la ejecución y solo muestra los resultados después de hacer refresh. Implementa Server-Sent Events (EventSource) o WebSocket para transmitir cada evento del agente (step_result, todo_update, verification, run_completed, run_failed) al cliente conforme ocurren. Asegúrate de que el estado de React/Vue se actualice con cada evento recibido usando setState o el equivalente reactivo, y que el componente del chat tenga un useEffect escuchando el stream de eventos.
2) Mensaje del usuario no se renderiza: El mensaje enviado por el usuario no aparece en la UI. Verifica que en el handler de onSubmit del formulario de chat se esté haciendo setMessages(prev => [...prev, { role: 'user', content: inputValue }]) ANTES de iniciar la llamada al agente, no después. El estado del input debe limpiarse y el mensaje debe agregarse al array de mensajes de forma optimista.
3) Error ACCESS_DENIED en write_file: El agente falla con {"code": "ACCESS_DENIED", "message": "No policy defined for tool: write_file"}. En el archivo de configuración de tools/políticas del agente (probablemente agentConfig.js, tools.js o similar), agrega write_file al array de herramientas permitidas con su schema y handler correspondiente. Ejemplo: { name: "write_file", description: "Writes content to a file", parameters: { path: "string", content: "string" }, handler: async (params) => { await fs.writeFile(params.path, params.content); return { success: true }; }}. Si no quieres permitir escritura de archivos, modifica el prompt del agente para que no intente usar esa herramienta.
4) TypeError en generateSummary: El error Cannot read properties of undefined (reading 'description') en index.mjs:1696 dentro de generateSummary ocurre porque estás iterando sobre el todoList y algún elemento es undefined o no tiene la propiedad description. Corrige agregando validación: todoList.filter(item => item && item.description).map(item => item.description) o usa optional chaining: item?.description ?? 'No description'. También verifica que cuando creas nuevos items en el todoList siempre incluyas todas las propiedades requeridas (id, task, status, description, stepIndex).
5) Manejo de errores y estado de la UI: Implementa un try-catch global en el executor del agente que capture cualquier excepción y emita un evento de error limpio al frontend. El frontend debe tener un estado error y mostrar un mensaje amigable en lugar de quedarse en blanco. Agrega: const [agentState, setAgentState] = useState<'idle' | 'running' | 'error' | 'completed'>('idle') y actualízalo según los eventos recibidos.