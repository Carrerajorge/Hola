# Replit — Solicitud de Soporte + Plan de Saneamiento AGRESIVO (Command Injection + SQL Injection + Secret Leaks)
**Fecha del scan:** 07 Jan 2026  
**Entorno:** Replit (workspace + ejecución en sandbox)  
**Hallazgos:** ~50 (principalmente ejecución de procesos con inputs no estáticos, SQL dinámico y exposición de credenciales)

---

## 1) Resumen ejecutivo (qué está pasando)
El análisis está reportando tres clases de riesgos:

1) **Command Injection (CRÍTICO)**  
   Se detectan llamadas a:
   - Python: `subprocess.run(...)` con argumentos variables (p. ej. paquetes `pkg` instalados dinámicamente).
   - Python asyncio: `asyncio.create_subprocess_exec(*args)` sin controlar la procedencia de `args`, y peor aún, `asyncio.create_subprocess_shell(cmd)` donde `cmd` puede ser string variable (riesgo alto).
   - Node/TS: `child_process.spawn(program, args)` donde `program` proviene de argumento de función, potencialmente controlable.

   **Objetivo:** garantizar que NINGÚN comando pueda ser construido/inyectado por entradas externas (usuario/LLM/requests/archivos). Se debe aplicar **allowlist estricta** y evitar el shell.

2) **SQL Injection (ALTO)**  
   Se detecta SQL dinámico con f-strings/concatenación que evita protecciones de SQLAlchemy. El enfoque correcto es usar `text()` con parámetros enlazados (bind params) y/o el ORM. (SQLAlchemy/guías públicas recomiendan `text("... :param")` + diccionario/kwargs). :contentReference[oaicite:0]{index=0}

3) **Secret Leaks (CRÍTICO)**  
   Se detectaron API keys / OAuth client secret / JWT / DB URL en `sandbox_workspace/.state/session_*.json` (archivos de estado).  
   **Esto implica que credenciales sensibles quedaron persistidas en archivos.**  
   Replit recomienda usar **Secrets** (encriptados) y consumirlos como variables de entorno, sin hardcode. :contentReference[oaicite:1]{index=1}

> Nota: No se incluyen valores reales de claves por seguridad. Se asume compromiso y se requiere rotación.

---

## 2) Requerimiento a Replit Support (lo que necesito que Replit haga)
### 2.1 Investigación de persistencia de secretos en `.state/session_*.json`
**Solicitud:** Revisar por qué el workspace está guardando variables sensibles o sesiones en `sandbox_workspace/.state/session_*.json` (o similares) y si existe:
- configuración para **no persistir** secretos/sesiones en archivos dentro del proyecto,
- opción para moverlos a almacenamiento protegido o cifrado fuera del repo,
- o una guía oficial para excluir `.state/` de exportaciones y escaneos.

### 2.2 Recomendación oficial de hardening para ejecución de procesos
**Solicitud:** Confirmar el enfoque recomendado en Replit para evitar command injection cuando el sistema requiere ejecutar:
- `pip install ...`
- `playwright install chromium`
- ejecución de scripts Python en sandbox

Y si existe una práctica recomendada para:
- bloquear `create_subprocess_shell`/`exec`,
- centralizar ejecución en un “runner” seguro,
- limitar permisos (si hay aislamiento extra disponible).

### 2.3 Validación de “Secrets Manager” como la ruta correcta
Confirmación de que Replit Secrets es la vía oficial para:
- API Keys
- OAuth Client Secret
- DB URLs
- tokens (JWT, etc.)  
y que se consumen vía env vars (esto es lo indicado en Replit Docs). :contentReference[oaicite:2]{index=2}

---

## 3) Acciones inmediatas (CRÍTICO — deben hacerse ya)
### 3.1 Rotación / Revocación total de credenciales expuestas
**Acción agresiva:** asumir compromiso y rotar TODO:
- Google APIs / Google Cloud keys
- OAuth Client Secret (regenerar)
- JWT / DB URLs / tokens de terceros

### 3.2 Eliminar y bloquear `.state/` y “session dumps”
**Acción:** borrar `sandbox_workspace/.state/session_*.json` y cualquier `.state/`.  
Luego: **ignorar para siempre** con `.gitignore`.  
**Importante:** Git no deja de trackear archivos ya rastreados solo por agregar `.gitignore`; hay que remover del index si estaban versionados. (Regla de gitignore). :contentReference[oaicite:3]{index=3}

**.gitignore mínimo recomendado:**
```gitignore
# Replit / sandbox state
**/.state/
sandbox_workspace/.state/

# env / secrets
.env
.env.*
*.key
*.pem
*.p12

# common secret dumps
**/*session*.json
**/*secrets*.json
